<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: draggable/draggable.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: draggable/draggable.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*
# ***** BEGIN LICENSE BLOCK *****
# Assets Library - The open source PHP/JavaScript/CSS library of Les Ateliers Pierrot
# Copyleft (c) 2013 Pierre Cassat and contributors
# &lt;www.ateliers-pierrot.fr> - &lt;contact@ateliers-pierrot.fr>
# License GPL-3.0 &lt;http://www.opensource.org/licenses/gpl-3.0.html>
# Sources &lt;http://github.com/atelierspierrot/assets-library>
#
# Ce programme est un logiciel libre distribuÃ© sous licence GNU/GPL.
#
# ***** END LICENSE BLOCK ***** */

/**
 * Draggable tool
 * @param object elt The element to work on
 * @param object opts A set of options to overwrite the class defaults
 */
Draggable.version = "1.0.0";
function Draggable(elt, opts) {

    var defaults = {
            outbound: false,                // allow to put the element outside the window
            frame: 'page',                  // 'page' or 'window' to select the outbound scope
            element: 'div',
            className: 'draggable',
            activeClassName: 'dragged',
            useGhost: true,
            ghostClassName: 'ghost',
            handlerElement: 'div',
            handlerClassName: 'dragger',
            handlerTitle: 'Click to drag this element',
            handler: null
        }, _this;


    createGhost = function(element, _this) {
        if (typeof element!=='object') { return; }
        var ghost = element.cloneNode(true), itemPositions;
        itemPositions = getOffset(element);
        addClassName(ghost, _this.options.ghostClassName);
        ghost.style.width = parseInt(itemPositions.width, 10)+'px';
        ghost.style.height = parseInt(itemPositions.height, 10)+'px';
        ghost.style.left = parseInt(itemPositions.left, 10)+'px';
        ghost.style.top = parseInt(itemPositions.top, 10)+'px';
        ghost.innerHtml = '';
        return ghost;
    }

    _mouseDown = function(e, _this) {
        var event = e || window.event, itemPositions;
        if (!_this.isDragged) {
            if (_this.options.useGhost) {
                _this.ghost = createGhost(_this.element, _this);
                _this.element.parentNode.insertBefore(_this.ghost, _this.element);
            }
            document.documentElement.addEventListener('mousemove', dragElt=function(e){ _mouseDrag(e, _this); }, false);
            document.documentElement.addEventListener('mouseup', stopDragElt=function(e){ _mouseUp(e, _this); }, false);
        }
    }
    
    _mouseDrag = function(e, _this) {
        var event = e || window.event;
        if (!_this.isDragged) {
            itemPositions = getOffset(_this.element);
            _this.itemX = parseInt(itemPositions.left, 10);
            _this.itemY = parseInt(itemPositions.top, 10);
            _this.startX = (event.clientX || event.pageX);
            _this.startY = (event.clientY || event.pageY);
            _this.isDragged = true;

console.debug('positions: ', itemPositions);
console.debug({ startX:_this.startX, startY:_this.startY, itemX:_this.itemX, itemY:_this.itemY });

            addClassName(_this.element, _this.options.activeClassName);
        }
        else {
            var eventX, eventY, eventOffsetX, eventOffsetY;
            eventX = (event.clientX || event.pageX);
            eventY = (event.clientY || event.pageY);
            eventOffsetX = eventX - _this.startX;
            eventOffsetY = eventY - _this.startY;

console.debug({ eventX:eventX, eventY:eventY, eventOffsetX:eventOffsetX, eventOffsetY:eventOffsetY });
console.debug('doDrag ', { left:parseInt(_this.itemX + eventOffsetX), top:parseInt(_this.itemY + eventOffsetY) });

            var new_left = parseInt((_this.itemX + eventOffsetX), 10);
            var new_top = parseInt((_this.itemY + eventOffsetY), 10);
            if (!_this.options.outbound) {
                var frameSizes = {}, elementOffset = getOffset(_this.element);
                if (_this.options.frame==='page') {
                    try {
                        frameSizes = getDocumentSizes();
                    } catch(e) {}
                }
                else if (_this.options.frame==='window') {
                    try {
                        frameSizes = getWindowSizes();
                    } catch(e) {}
                }
console.debug(frameSizes);
                if (new_left&lt;0) new_left = 0;
                if (new_left > (frameSizes.width-elementOffset.width)) {
                    new_left = frameSizes.width-elementOffset.width;
                }
                if (new_top&lt;0) new_top = 0;
                if (new_top > frameSizes.height-elementOffset.height) {
                    new_top = frameSizes.height-elementOffset.height;
                }
            }
            _this.element.style.left = new_left+'px';
            _this.element.style.top = new_top+'px';
        }
    }
    
    _mouseUp = function(e, _this) {
        var event = e || window.event;
        if (_this.options.useGhost) {
            _this.element.parentNode.removeChild(_this.ghost);
        }
        removeClassName(_this.element, _this.options.activeClassName);
        document.documentElement.removeEventListener('mousemove', dragElt, false);
        document.documentElement.removeEventListener('mouseup', stopDragElt, false);
        _this.isDragged = false;
    }

    this.options    =extend(clone(defaults), opts);
    this.element    =elt;
    this.ghost      =null;
    this.startX     =0;
    this.startY     =0;
    this.itemX      =0;
    this.itemY      =0;
    this.isDragged  =false;

    addClassName(this.element, this.options.className);
    if (this.options.handler===null) {
        var handler = document.createElement( this.options.handlerElement );
        addClassName(handler, this.options.handlerClassName);
        this.element.appendChild(handler);
        this.options.handler = handler;
    }
    if (this.options.handlerTitle!==undefined && this.options.handlerTitle!==null && this.options.handlerTitle.length>0) {
        this.options.handler.setAttribute('title', this.options.handlerTitle);
    }
    _this = clone(this);
    this.options.handler.onmousedown = function(e){ _mouseDown(e, _this); return false; };
    this.options.handler.onselectstart = function(){ return false; };
    return this;
}

/**
 * Extend the Element prototype to allow "element._draggable(opts)"
 */
Element.prototype._draggable = function(opts) {
    Draggable(this, opts);
};

// Endfile</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Global</h3><ul><li><a href="global.html#_dbg">_dbg</a></li><li><a href="global.html#_dbg_info">_dbg_info</a></li><li><a href="global.html#_dbg_log">_dbg_log</a></li><li><a href="global.html#add_collection_field">add_collection_field</a></li><li><a href="global.html#addClassName">addClassName</a></li><li><a href="global.html#applyCallback">applyCallback</a></li><li><a href="global.html#array_remove">array_remove</a></li><li><a href="global.html#Blind">Blind</a></li><li><a href="global.html#capitaliseFirstLetter">capitaliseFirstLetter</a></li><li><a href="global.html#change_class_check_onload">change_class_check_onload</a></li><li><a href="global.html#change_class_oncheck">change_class_oncheck</a></li><li><a href="global.html#checkAll">checkAll</a></li><li><a href="global.html#dump">dump</a></li><li><a href="global.html#each">each</a></li><li><a href="global.html#Effect">Effect</a></li><li><a href="global.html#EffectRegistry">EffectRegistry</a></li><li><a href="global.html#extend">extend</a></li><li><a href="global.html#Fade">Fade</a></li><li><a href="global.html#field_toggler">field_toggler</a></li><li><a href="global.html#font_size">font_size</a></li><li><a href="global.html#get_url">get_url</a></li><li><a href="global.html#getClasses">getClasses</a></li><li><a href="global.html#getClassNameIndex">getClassNameIndex</a></li><li><a href="global.html#getOffset">getOffset</a></li><li><a href="global.html#getStyleAttribute">getStyleAttribute</a></li><li><a href="global.html#getWindowSizes">getWindowSizes</a></li><li><a href="global.html#hasClassName">hasClassName</a></li><li><a href="global.html#href_goto">href_goto</a></li><li><a href="global.html#html_characters">html_characters</a></li><li><a href="global.html#in_array">in_array</a></li><li><a href="global.html#is_defined">is_defined</a></li><li><a href="global.html#is_url">is_url</a></li><li><a href="global.html#join">join</a></li><li><a href="global.html#keyboard_unicodes">keyboard_unicodes</a></li><li><a href="global.html#multiExtend">multiExtend</a></li><li><a href="global.html#NEWPOPUPWINDOW">NEWPOPUPWINDOW</a></li><li><a href="global.html#onDocumentLoad">onDocumentLoad</a></li><li><a href="global.html#opener_focus">opener_focus</a></li><li><a href="global.html#popup_set">popup_set</a></li><li><a href="global.html#Registry">Registry</a></li><li><a href="global.html#remove_collection_field">remove_collection_field</a></li><li><a href="global.html#removeClassName">removeClassName</a></li><li><a href="global.html#Select">Select</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#settings">settings</a></li><li><a href="global.html#show_hide">show_hide</a></li><li><a href="global.html#show_hide_init">show_hide_init</a></li><li><a href="global.html#Slide">Slide</a></li><li><a href="global.html#TabContent">TabContent</a></li><li><a href="global.html#toggleShowHide">toggleShowHide</a></li><li><a href="global.html#TOOLTIP">TOOLTIP</a></li><li><a href="global.html#trigger_click">trigger_click</a></li><li><a href="global.html#uniqid">uniqid</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Sat Dec 21 2013 13:27:54 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
